---
apiVersion: "tekton.dev/v1beta1"
kind: "PipelineRun"
metadata:
  annotations:
    pipelinesascode.tekton.dev/task: "git-clone"
    pipelinesascode.tekton.dev/on-event: "[pull_request, push]"
    pipelinesascode.tekton.dev/on-target-branch: "main"
    pipelinesascode.tekton.dev/max-keep-runs: "5"
  name: "git-demo-microservice"
spec:
  pipelineSpec:
      workspaces:
        - name: code
      tasks:
        - name: fetch-source
          taskRef:
            name: git-clone
          workspaces:
            - name: output
              workspace: code
          params:
            - name: url
              value: https://github.com/sgartner03/demo-microservice
        - name: maven-build
          runAfter:
            - fetch-source
          taskRef:
            resolver: cluster
            params:
              - name: kind
                value: task
              - name: name
                value: maven-build
              - name: namespace
                value: gp-pipelines
          workspaces:
            - name: input
              workspace: code
          params:
            - name: repo
              value: demo-microservice
            - name: branch
              value: main
  workspaces:
    - name: code
      volumeClaimTemplate:
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 300Mi
          volumeMode: Filesystem
    - name: cache
      persistentVolumeClaim:
        claimName: maven-cache
